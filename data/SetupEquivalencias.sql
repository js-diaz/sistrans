DROP TABLE SUSTITUTOS_PRODUCTO;
DROP TABLE SUSTITUTOS_INGREDIENTE;
DROP TABLE SUSTITUCION_PRODUCTO;
DROP TABLE SUSTITUCION_INGREDIENTE;
DROP TABLE SUSN_INGREDIENTE_EN_PRODUCTO;

CREATE TABLE SUSTITUTOS_PRODUCTO
(
    ID_PRODUCTO INTEGER CONSTRAINT SUSTPROD_PRODUCTO_EXISTE NOT NULL,
    ID_SUSTITUTO INTEGER CONSTRAINT SUSTPROD_SUSTITUTO_EXISTE NOT NULL,
    NOMBRE_RESTAURANTE VARCHAR(20) CONSTRAINT SUSTPROD_REST_EXISTE NOT NULL,
    CONSTRAINT PK_SUSTITUTOS_PRODUCTO PRIMARY KEY (ID_PRODUCTO, ID_SUSTITUTO, NOMBRE_RESTAURANTE),
    CONSTRAINT FK_SUSTPROD_PRODUCTO FOREIGN KEY (ID_PRODUCTO, NOMBRE_RESTAURANTE) REFERENCES INFO_PROD_REST(ID_PRODUCTO, NOMBRE_RESTAURANTE),
    CONSTRAINT FK_SUSTPROD_SUSTITUTO FOREIGN KEY (ID_SUSTITUTO) REFERENCES PRODUCTO(ID),
    CONSTRAINT PROD_SUSTITUIR_DIFERENTE CHECK (NOT ID_PRODUCTO = ID_SUSTITUTO)
);

CREATE TABLE SUSTITUTOS_INGREDIENTE
(
    ID_INGREDIENTE INTEGER CONSTRAINT SUSTING_INGREDIENTE_EXISTE NOT NULL,
    ID_SUSTITUTO INTEGER CONSTRAINT SUSTING_SUSTITUTO_EXISTE NOT NULL,
    NOMBRE_RESTAURANTE VARCHAR(20) CONSTRAINT SUSTING_RESTAURANTE_EXISTE NOT NULL,
    CONSTRAINT PK_SUSTITUTOS_INGREDIENTE PRIMARY KEY (ID_INGREDIENTE, ID_SUSTITUTO, NOMBRE_RESTAURANTE),
    CONSTRAINT FK_SUSTING_INGREDIENTE FOREIGN KEY (ID_INGREDIENTE, NOMBRE_RESTAURANTE) REFERENCES INFO_ING_REST(ID_INGREDIENTE, NOMBRE_RESTAURANTE),
    CONSTRAINT FK_SUSTING_SUSTITUTO FOREIGN KEY (ID_SUSTITUTO) REFERENCES INGREDIENTE(ID),
    CONSTRAINT ING_SUSTITUIR_DIFERENTE CHECK (NOT ID_INGREDIENTE = ID_SUSTITUTO)
);

CREATE TABLE SUSTITUCION_PRODUCTO
(
    ID_ORIGINAL INTEGER CONSTRAINT SUSNPROD_ORIGINAL_EXISTE NOT NULL,
    ID_SUSTITUTO INTEGER CONSTRAINT SUSNPROD_SUSTITUTO_EXISTE NOT NULL,
    NUMERO_CUENTA VARCHAR(20) CONSTRAINT SUSNPROD_CUENTA_EXISTE NOT NULL,
    NOMBRE_MENU VARCHAR(20) CONSTRAINT SUSNPROD_MENU_EXISTE NOT NULL,
    NOMBRE_RESTAURANTE VARCHAR(20) CONSTRAINT SUSNPROD_RESTAURANTE_EXISTE NOT NULL,
    CONSTRAINT PK_SUSTITUCION_PRODUCTO PRIMARY KEY (ID_ORIGINAL, ID_SUSTITUTO, NUMERO_CUENTA, NOMBRE_MENU, NOMBRE_RESTAURANTE),
    CONSTRAINT FK_SUSNPROD_ORIGINAL FOREIGN KEY (ID_ORIGINAL) REFERENCES PRODUCTO(ID),
    CONSTRAINT FK_SUSNPROD_SUSTITUTO FOREIGN KEY (ID_SUSTITUTO) REFERENCES PRODUCTO(ID),
    CONSTRAINT FK_SUSNPROD_PEDIDO FOREIGN KEY (NUMERO_CUENTA, NOMBRE_MENU, NOMBRE_RESTAURANTE) REFERENCES PEDIDO_MENU (NUMERO_CUENTA, NOMBRE_MENU, NOMBRE_RESTAURANTE)
);

CREATE TABLE SUSTITUCION_INGREDIENTE
(
    ID_ORIGINAL INTEGER CONSTRAINT SUSNING_ORIGINAL_EXISTE NOT NULL,
    ID_SUSTITUTO INTEGER CONSTRAINT SUSNING_SUSTITUTO_EXISTE NOT NULL,
    NUMERO_CUENTA VARCHAR(20) CONSTRAINT SUSNING_CUENTA_EXISTE NOT NULL,
    ID_PRODUCTO INTEGER CONSTRAINT SUSNING_PRODUCTO_EXISTE NOT NULL,
    NOMBRE_RESTAURANTE VARCHAR(20) CONSTRAINT SUSNING_RESTAURANTE_EXISTE NOT NULL,
    CONSTRAINT PK_SUSTITUCION_INGREDIENTE PRIMARY KEY (ID_ORIGINAL, ID_SUSTITUTO, NUMERO_CUENTA, ID_PRODUCTO, NOMBRE_RESTAURANTE),
    CONSTRAINT FK_SUSNING_ORIGINAL FOREIGN KEY (ID_ORIGINAL) REFERENCES INGREDIENTE(ID),
    CONSTRAINT FK_SUSNING_SUSTITUTO FOREIGN KEY (ID_SUSTITUTO) REFERENCES INGREDIENTE(ID),
    CONSTRAINT FK_SUSNING_PEDIDO FOREIGN KEY (NUMERO_CUENTA, ID_PRODUCTO, NOMBRE_RESTAURANTE) REFERENCES PEDIDO_PROD (NUMERO_CUENTA, ID_PRODUCTO, NOMBRE_RESTAURANTE)
);

CREATE TABLE SUSN_INGREDIENTE_EN_PRODUCTO
(
    ID_ORIGINAL INTEGER CONSTRAINT SUSNINGPROD_ORIGINAL_EXISTE NOT NULL,
    ID_SUSTITUTO INTEGER CONSTRAINT SUSNINGPROD_SUSTITUTO_EXISTE NOT NULL,
    ID_PRODUCTO INTEGER CONSTRAINT SUSNINGPROD_PRODUCTO_EXISTE NOT NULL,
    NUMERO_CUENTA VARCHAR(20) CONSTRAINT SUSNINGPROD_CUENTA_EXISTE NOT NULL,
    NOMBRE_MENU VARCHAR(20) CONSTRAINT SUSNINGPROD_MENU_EXISTE NOT NULL,
    NOMBRE_RESTAURANTE VARCHAR(20) CONSTRAINT SUSNINGPROD_REST_EXISTE NOT NULL,
    CONSTRAINT PK_SUSN_ING_EN_PRODUCTO PRIMARY KEY (ID_ORIGINAL, ID_SUSTITUTO, ID_PRODUCTO, NUMERO_CUENTA, NOMBRE_MENU, NOMBRE_RESTAURANTE),
    CONSTRAINT FK_SUSNINGPROD_ORIGINAL FOREIGN KEY (ID_ORIGINAL) REFERENCES INGREDIENTE(ID),
    CONSTRAINT FK_SUSNINGPROD_SUSTITUTO FOREIGN KEY (ID_SUSTITUTO) REFERENCES INGREDIENTE(ID),
    CONSTRAINT FK_SUSNINGPROD_PRODUCTO FOREIGN KEY (ID_PRODUCTO) REFERENCES PRODUCTO(ID),
    CONSTRAINT FK_SUSNINGPROD_PEDIDO FOREIGN KEY (NUMERO_CUENTA, NOMBRE_MENU, NOMBRE_RESTAURANTE) REFERENCES PEDIDO_MENU (NUMERO_CUENTA, NOMBRE_MENU, NOMBRE_RESTAURANTE)
);